# AI å¼€å‘è°ƒåº¦æœåŠ¡ - æ–¹æ¡ˆ B é‡æ„æ–¹æ¡ˆ

## æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ–¹æ¡ˆåç§°** | Python æ”¹è‰¯ç‰ˆ - Git Worktree å¹¶è¡Œæ¶æ„ |
| **ç‰ˆæœ¬** | v1.0 |
| **åˆ›å»ºæ—¥æœŸ** | 2026-01-10 |
| **é¢„è®¡å‘¨æœŸ** | 3-4 å‘¨ |
| **æŠ€æœ¯æ ˆ** | Python 3.11+ / FastAPI / React + Vite / Git Worktree |

---

## ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [æ¶æ„è®¾è®¡](#2-æ¶æ„è®¾è®¡)
3. [æ ¸å¿ƒåŠŸèƒ½](#3-æ ¸å¿ƒåŠŸèƒ½)
4. [å®æ–½æ­¥éª¤](#4-å®æ–½æ­¥éª¤)
5. [æŠ€æœ¯ç»†èŠ‚](#5-æŠ€æœ¯ç»†èŠ‚)
6. [æµ‹è¯•è®¡åˆ’](#6-æµ‹è¯•è®¡åˆ’)
7. [éƒ¨ç½²æ–¹æ¡ˆ](#7-éƒ¨ç½²æ–¹æ¡ˆ)
8. [é£é™©ç®¡ç†](#8-é£é™©ç®¡ç†)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é‡æ„ç›®æ ‡

å°†ç°æœ‰çš„ AI å¼€å‘è°ƒåº¦æœåŠ¡ä»å•ä¸€å·¥ä½œåŒºæ¨¡å¼å‡çº§ä¸º **Git Worktree å¹¶è¡Œæ¶æ„**ï¼Œå®ç°ï¼š

- âœ… **å¼€ç®±å³ç”¨**ï¼šé€šè¿‡ `npx kaka-dev` ä¸€é”®å¯åŠ¨
- âœ… **çœŸæ­£å¹¶è¡Œ**ï¼šå¤šä¸ª AI ä»»åŠ¡åœ¨ç‹¬ç«‹å·¥ä½œåŒºåŒæ—¶è¿è¡Œ
- âœ… **å›¾å½¢åŒ–é…ç½®**ï¼šäº¤äº’å¼ Web é…ç½®å‘å¯¼
- âœ… **å®æ—¶ç›‘æ§**ï¼šWebSocket å®æ—¶ä»»åŠ¡çŠ¶æ€å’Œæ—¥å¿—æµ
- âœ… **è·¨å¹³å°æ”¯æŒ**ï¼šmacOS / Linux / Windows

### 1.2 å½“å‰é—®é¢˜

| é—®é¢˜ | æè¿° | å½±å“ |
|------|------|------|
| **å•ä»»åŠ¡ç“¶é¢ˆ** | æ‰€æœ‰ä»»åŠ¡åœ¨åŒä¸€å·¥ä½œåŒºä¸²è¡Œæ‰§è¡Œ | æ•ˆç‡ä½ä¸‹ |
| **é…ç½®å¤æ‚** | éœ€è¦æ‰‹åŠ¨ç¼–è¾‘ YAML å’Œç¯å¢ƒå˜é‡ | ä½¿ç”¨é—¨æ§›é«˜ |
| **ç›‘æ§å—é™** | ä»…é€šè¿‡æ—¥å¿—æ–‡ä»¶æŸ¥çœ‹çŠ¶æ€ | ä½“éªŒä¸ä½³ |
| **å®‰è£…å›°éš¾** | éœ€è¦ Python ç¯å¢ƒå’Œä¾èµ–å®‰è£… | éƒ¨ç½²æˆæœ¬é«˜ |

### 1.3 æ”¹è¿›æ•ˆæœ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ”¹è¿›å‰åå¯¹æ¯”                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å½“å‰æ¨¡å¼                   é‡æ„åæ¨¡å¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Issue 1 â”‚ â”€â”€â”€â”€â”€â”€â”€â–º     â”‚ Issue 1 â”‚ Issue 2 â”‚  â”‚     â”‚
â”‚  â”‚ Issue 2 â”‚     ä¸²è¡Œ     â”‚   â–¼       â”‚   â–¼      â”‚  â”‚     â”‚
â”‚  â”‚ Issue 3 â”‚     æ‰§è¡Œ     â”‚ Worktreeâ”‚ Worktree â”‚  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   #1    â”‚   #2     â”‚  â”‚     â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                            å¹¶è¡Œæ‰§è¡Œ                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. æ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         npx kaka-dev                              â”‚
â”‚                      (Node.js åŒ…è£…å™¨)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Frontend      â”‚              â”‚  FastAPI Backend â”‚
        â”‚  (React/Vite)  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  (Python 3.11+)  â”‚
        â”‚                â”‚  WebSocket   â”‚                  â”‚
        â”‚  - é…ç½®å‘å¯¼     â”‚              â”‚  - Webhook æ¥æ”¶  â”‚
        â”‚  - ä»»åŠ¡çœ‹æ¿     â”‚              â”‚  - Worktree ç®¡ç† â”‚
        â”‚  - æ—¥å¿—æŸ¥çœ‹     â”‚              â”‚  - Claude è°ƒç”¨   â”‚
        â”‚  - Worktree ç›‘æ§â”‚              â”‚  - ä»»åŠ¡è°ƒåº¦      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                             â”‚                  â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
            â”‚  Worktree #1   â”‚          â”‚  Worktree #2     â”‚  â”‚ Worktree #N â”‚
            â”‚  (éš”ç¦»ç¯å¢ƒ)     â”‚          â”‚  (éš”ç¦»ç¯å¢ƒ)       â”‚  â”‚ (éš”ç¦»ç¯å¢ƒ)  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æŠ€æœ¯æ ˆ

#### åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Python** | 3.11+ | æ ¸å¿ƒè¯­è¨€ |
| **FastAPI** | 0.104+ | Web æ¡†æ¶ |
| **Uvicorn** | 0.24+ | ASGI æœåŠ¡å™¨ |
| **SQLAlchemy** | 2.0+ | ORM |
| **SQLite** | 3.x | æ•°æ®åº“ |
| **GitPython** | 3.1+ | Git æ“ä½œ |
| **WebSockets** | 12.0+ | å®æ—¶é€šä¿¡ |
| **Pydantic** | 2.5+ | æ•°æ®éªŒè¯ |

#### å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **React** | 18.3+ | UI æ¡†æ¶ |
| **TypeScript** | 5.3+ | ç±»å‹å®‰å…¨ |
| **Vite** | 5.0+ | æ„å»ºå·¥å…· |
| **TailwindCSS** | 3.4+ | æ ·å¼æ¡†æ¶ |
| **Axios** | 1.6+ | HTTP å®¢æˆ·ç«¯ |
| **React Query** | 5.17+ | æ•°æ®è·å– |
| **Zustand** | 4.4+ | çŠ¶æ€ç®¡ç† |

#### æ‰“åŒ…åˆ†å‘

| æŠ€æœ¯ | ç”¨é€” |
|------|------|
| **NPX** | è·¨å¹³å°å®‰è£…å…¥å£ |
| **PyInstaller** | Python å•æ–‡ä»¶æ‰“åŒ… |
| **shiv** | Python åº”ç”¨æ‰“åŒ…ï¼ˆå¤‡é€‰ï¼‰ |

### 2.3 ç›®å½•ç»“æ„

```
kaka/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py                      # FastAPI åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config.py                    # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ models/                      # Pydantic æ¨¡å‹
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ webhook_handler.py       # Webhook å¤„ç†
â”‚   â”‚   â”œâ”€â”€ claude_service.py        # Claude è°ƒç”¨
â”‚   â”‚   â”œâ”€â”€ git_service.py           # Git æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ github_service.py        # GitHub API
â”‚   â”‚   â”œâ”€â”€ task_service.py          # ä»»åŠ¡ç®¡ç†
â”‚   â”‚   â””â”€â”€ worktree_service.py      # ğŸ†• Worktree ç®¡ç†
â”‚   â”œâ”€â”€ api/                         # ğŸ†• API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ config.py                # é…ç½®ç®¡ç† API
â”‚   â”‚   â”œâ”€â”€ tasks.py                 # ä»»åŠ¡ API
â”‚   â”‚   â”œâ”€â”€ worktrees.py             # Worktree API
â”‚   â”‚   â””â”€â”€ websocket.py             # WebSocket å¤„ç†
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ logger.py
â”‚       â””â”€â”€ validators.py
â”œâ”€â”€ frontend/                        # ğŸ†• å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ ConfigWizard.tsx    # é…ç½®å‘å¯¼
â”‚   â”‚   â”‚   â”œâ”€â”€ TaskMonitor.tsx     # ä»»åŠ¡ç›‘æ§
â”‚   â”‚   â”‚   â”œâ”€â”€ TaskCard.tsx        # ä»»åŠ¡å¡ç‰‡
â”‚   â”‚   â”‚   â”œâ”€â”€ LogViewer.tsx       # æ—¥å¿—æŸ¥çœ‹å™¨
â”‚   â”‚   â”‚   â””â”€â”€ WorktreeList.tsx    # Worktree åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx       # ä»ªè¡¨æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ Settings.tsx        # è®¾ç½®é¡µé¢
â”‚   â”‚   â”‚   â””â”€â”€ Tasks.tsx           # ä»»åŠ¡é¡µé¢
â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts              # API å®¢æˆ·ç«¯
â”‚   â”‚   â”‚   â””â”€â”€ websocket.ts        # WebSocket å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ store/
â”‚   â”‚   â”‚   â””â”€â”€ useStore.ts         # Zustand çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts            # TypeScript ç±»å‹
â”‚   â”‚   â”œâ”€â”€ App.tsx
â”‚   â”‚   â””â”€â”€ main.tsx
â”‚   â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â””â”€â”€ tailwind.config.js
â”œâ”€â”€ npx-cli/                         # ğŸ†• NPX åŒ…è£…å™¨
â”‚   â”œâ”€â”€ bin/
â”‚   â”‚   â””â”€â”€ cli.js                   # NPX å…¥å£
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ README.md
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ setup.sh
â”‚   â”œâ”€â”€ dev.sh
â”‚   â”œâ”€â”€ build.sh                     # ğŸ†• æ„å»ºè„šæœ¬
â”‚   â””â”€â”€ package-npx.sh               # ğŸ†• NPX æ‰“åŒ…
â”œâ”€â”€ config/
â”‚   â””â”€â”€ config.yaml
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_worktree_service.py     # ğŸ†• Worktree æµ‹è¯•
â”‚   â””â”€â”€ test_api.py                  # ğŸ†• API æµ‹è¯•
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ README.md
â””â”€â”€ REFACTOR_PLAN.md                 # æœ¬æ–‡æ¡£
```

---

## 3. æ ¸å¿ƒåŠŸèƒ½

### 3.1 Git Worktree å¹¶è¡Œå¼€å‘

#### åŠŸèƒ½æè¿°

ä¸ºæ¯ä¸ª AI ä»»åŠ¡åˆ›å»ºç‹¬ç«‹çš„ Git Worktreeï¼Œå®ç°çœŸæ­£çš„å¹¶è¡Œå¼€å‘éš”ç¦»ã€‚

#### å·¥ä½œæµç¨‹

```
1. Webhook è§¦å‘ (Issue #123)
   â”‚
2. åˆ›å»º Worktree
   â”‚  $ git worktree add .worktrees/issue-123 -b ai/issue-123
   â”‚
3. åœ¨ Worktree ä¸­æ‰§è¡Œ AI å¼€å‘
   â”‚  $ cd .worktrees/issue-123
   â”‚  $ claude-code "Implement feature..."
   â”‚
4. æäº¤å¹¶æ¨é€
   â”‚  $ git add . && git commit -m "..."
   â”‚  $ git push origin ai/issue-123
   â”‚
5. åˆ›å»º PR
   â”‚  $ gh pr create --base main --head ai/issue-123
   â”‚
6. æ¸…ç† Worktree
   â”‚  $ git worktree remove .worktrees/issue-123
```

#### æ ¸å¿ƒä»£ç 

```python
# app/services/worktree_service.py
from pathlib import Path
from typing import Optional
import git
from loguru import logger

class WorktreeService:
    """Git Worktree ç®¡ç†æœåŠ¡"""

    def __init__(self, repo_path: str):
        self.repo_path = Path(repo_path)
        self.repo = git.Repo(repo_path)
        self.worktrees_dir = self.repo_path / ".worktrees"
        self.worktrees_dir.mkdir(exist_ok=True)

    def create_worktree(
        self,
        issue_id: int,
        branch_name: str,
        base_branch: str = "main"
    ) -> Path:
        """
        ä¸º Issue åˆ›å»ºéš”ç¦»çš„ Worktree

        Args:
            issue_id: GitHub Issue ç¼–å·
            branch_name: åˆ†æ”¯åç§°
            base_branch: åŸºç¡€åˆ†æ”¯

        Returns:
            Worktree è·¯å¾„
        """
        worktree_path = self.worktrees_dir / f"issue-{issue_id}"

        try:
            # åˆ›å»ºæ–°åˆ†æ”¯
            self.repo.git.checkout(base_branch)
            self.repo.git.pull(origin base_branch)

            # åˆ›å»º worktree
            self.repo.git.worktree(
                "add",
                str(worktree_path),
                "-b",
                branch_name
            )

            logger.info(
                f"Created worktree for Issue #{issue_id}: {worktree_path}"
            )
            return worktree_path

        except git.GitError as e:
            logger.error(f"Failed to create worktree: {e}")
            raise

    def cleanup_worktree(self, issue_id: int):
        """æ¸…ç†æŒ‡å®šçš„ Worktree"""
        worktree_path = self.worktrees_dir / f"issue-{issue_id}"

        if worktree_path.exists():
            try:
                self.repo.git.worktree("remove", str(worktree_path))
                logger.info(f"Removed worktree: {worktree_path}")
            except git.GitError as e:
                logger.warning(f"Failed to remove worktree: {e}")

    def list_active_worktrees(self) -> list[dict]:
        """åˆ—å‡ºæ‰€æœ‰æ´»è·ƒçš„ Worktree"""
        try:
            result = self.repo.git.worktree("list", "--porcelain")
            worktrees = []

            current_worktree = None
            for line in result.split('\n'):
                if line.startswith('worktree '):
                    current_worktree = {'path': line.split(' ', 1)[1]}
                elif line.startswith('branch ') and current_worktree:
                    current_worktree['branch'] = line.split(' ', 1)[1]
                    worktrees.append(current_worktree)

            return [
                wt for wt in worktrees
                if '.worktrees' in wt['path']
            ]
        except git.GitError:
            return []

    def cleanup_orphaned_worktrees(self, active_issue_ids: list[int]):
        """æ¸…ç†ä¸å±äºæ´»è·ƒ Issue çš„ Worktree"""
        worktrees = self.list_active_worktrees()

        for wt in worktrees:
            # ä»è·¯å¾„æå– issue ID
            try:
                issue_id = int(wt['path'].split('issue-')[-1].split('/')[0])
                if issue_id not in active_issue_ids:
                    self.cleanup_worktree(issue_id)
            except (ValueError, IndexError):
                continue
```

### 3.2 å‰ç«¯é…ç½®å‘å¯¼

#### åŠŸèƒ½æè¿°

æä¾›äº¤äº’å¼ Web é…ç½®ç•Œé¢ï¼Œå¼•å¯¼ç”¨æˆ·å®Œæˆåˆå§‹é…ç½®ã€‚

#### é¡µé¢æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 1: æ¬¢è¿                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸ‰ æ¬¢è¿ä½¿ç”¨ AI å¼€å‘è°ƒåº¦æœåŠ¡                        â”‚    â”‚
â”‚  â”‚                                                    â”‚    â”‚
â”‚  â”‚  æœ¬æœåŠ¡å°†é€šè¿‡ GitHub Webhook è‡ªåŠ¨è°ƒç”¨ AI           â”‚    â”‚
â”‚  â”‚  è¿›è¡Œå¼€å‘å·¥ä½œï¼Œè‡ªåŠ¨åˆ›å»ºåˆ†æ”¯ã€æäº¤ä»£ç å’Œç”Ÿæˆ PRã€‚    â”‚    â”‚
â”‚  â”‚                                                    â”‚    â”‚
â”‚  â”‚         [å¼€å§‹é…ç½®]                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 2: GitHub é…ç½®              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  GitHub Personal Access Token                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚ ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx   â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                    â”‚    â”‚
â”‚  â”‚  ğŸ“– å¦‚ä½•è·å– Token â†’                               â”‚    â”‚
â”‚  â”‚                                                    â”‚    â”‚
â”‚  â”‚  ä»“åº“ä¿¡æ¯                                          â”‚    â”‚
â”‚  â”‚  æ‰€æœ‰è€…: â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚    â”‚
â”‚  â”‚         â”‚ your-username           â”‚               â”‚    â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚    â”‚
â”‚  â”‚  ä»“åº“å: â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚    â”‚
â”‚  â”‚         â”‚ your-repo               â”‚               â”‚    â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚    â”‚
â”‚  â”‚                                                    â”‚    â”‚
â”‚  â”‚              [ä¸Šä¸€æ­¥]  [ä¸‹ä¸€æ­¥]                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 3: æœ¬åœ°ä»“åº“è·¯å¾„            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  è¯·è¾“å…¥æœ¬åœ°ä»“åº“çš„ç»å¯¹è·¯å¾„ï¼š                        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚ /Users/seanzou/Test/kaka                   â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                    â”‚    â”‚
â”‚  â”‚  âœ… è·¯å¾„éªŒè¯é€šè¿‡                                   â”‚    â”‚
â”‚  â”‚                                                    â”‚    â”‚
â”‚  â”‚              [ä¸Šä¸€æ­¥]  [ä¸‹ä¸€æ­¥]                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 4: Claude API                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Anthropic API Key                                â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚ sk-ant-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                    â”‚    â”‚
â”‚  â”‚  ğŸ“– å¦‚ä½•è·å– API Key â†’                            â”‚    â”‚
â”‚  â”‚                                                    â”‚    â”‚
â”‚  â”‚              [ä¸Šä¸€æ­¥]  [å®Œæˆ]                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 5: å®Œæˆ                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸ‰ é…ç½®å®Œæˆï¼                                     â”‚    â”‚
â”‚  â”‚                                                    â”‚    â”‚
â”‚  â”‚  Webhook URL:                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚ https://your-domain.com/webhook/github     â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚  [å¤åˆ¶]                                           â”‚    â”‚
â”‚  â”‚                                                    â”‚    â”‚
â”‚  â”‚  Webhook Secret:                                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚ whsec_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx   â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚  [å¤åˆ¶]                                           â”‚    â”‚
â”‚  â”‚                                                    â”‚    â”‚
â”‚  â”‚         [å‰å¾€ä»ªè¡¨æ¿]  [æŸ¥çœ‹é…ç½®æ–‡æ¡£]               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ ¸å¿ƒä»£ç 

```typescript
// frontend/src/components/ConfigWizard.tsx
import { useState } from 'react';
import { ChevronRight, ChevronLeft, Check } from 'lucide-react';
import { apiClient } from '@/lib/api';

interface ConfigData {
  githubToken: string;
  repoOwner: string;
  repoName: string;
  repoPath: string;
  anthropicApiKey: string;
}

export function ConfigWizard() {
  const [step, setStep] = useState(1);
  const [loading, setLoading] = useState(false);
  const [config, setConfig] = useState<ConfigData>({
    githubToken: '',
    repoOwner: '',
    repoName: '',
    repoPath: '',
    anthropicApiKey: '',
  });

  const steps = [
    { id: 1, title: 'æ¬¢è¿' },
    { id: 2, title: 'GitHub é…ç½®' },
    { id: 3, title: 'ä»“åº“è·¯å¾„' },
    { id: 4, title: 'Claude API' },
    { id: 5, title: 'å®Œæˆ' },
  ];

  const handleNext = async () => {
    if (step === 3) {
      // éªŒè¯è·¯å¾„
      setLoading(true);
      try {
        await apiClient.post('/api/config/validate-path', {
          path: config.repoPath,
        });
      } catch (error) {
        alert('è·¯å¾„éªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥è·¯å¾„æ˜¯å¦æ­£ç¡®');
        setLoading(false);
        return;
      }
      setLoading(false);
    }

    if (step === 4) {
      // ä¿å­˜é…ç½®
      setLoading(true);
      try {
        await apiClient.post('/api/config/save', config);
      } catch (error) {
        alert('é…ç½®ä¿å­˜å¤±è´¥');
        setLoading(false);
        return;
      }
      setLoading(false);
    }

    if (step < 5) {
      setStep(step + 1);
    }
  };

  const handleBack = () => {
    if (step > 1) {
      setStep(step - 1);
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
      {/* æ­¥éª¤æŒ‡ç¤ºå™¨ */}
      <div className="pt-8">
        <div className="max-w-3xl mx-auto px-4">
          <div className="flex items-center justify-between">
            {steps.map((s, index) => (
              <div key={s.id} className="flex items-center">
                <div className={`
                  w-10 h-10 rounded-full flex items-center justify-center
                  ${step === s.id ? 'bg-blue-600 text-white' : ''}
                  ${step > s.id ? 'bg-green-500 text-white' : 'bg-gray-200'}
                `}>
                  {step > s.id ? <Check size={20} /> : s.id}
                </div>
                <span className="ml-2 text-sm font-medium">{s.title}</span>
                {index < steps.length - 1 && (
                  <div className="w-16 h-1 bg-gray-200 mx-4" />
                )}
              </div>
            ))}
          </div>
        </div>
      </div>

      {/* å†…å®¹åŒºåŸŸ */}
      <div className="max-w-2xl mx-auto mt-12 px-4">
        {step === 1 && <WelcomeStep onNext={handleNext} />}
        {step === 2 && (
          <GitHubConfigStep
            config={config}
            onChange={setConfig}
            onNext={handleNext}
            onBack={handleBack}
          />
        )}
        {step === 3 && (
          <RepoPathStep
            config={config}
            onChange={setConfig}
            onNext={handleNext}
            onBack={handleBack}
            loading={loading}
          />
        )}
        {step === 4 && (
          <ClaudeAPIStep
            config={config}
            onChange={setConfig}
            onNext={handleNext}
            onBack={handleBack}
            loading={loading}
          />
        )}
        {step === 5 && <CompletionStep config={config} />}
      </div>
    </div>
  );
}
```

### 3.3 ä»»åŠ¡ç›‘æ§çœ‹æ¿

#### åŠŸèƒ½æè¿°

å®æ—¶æ˜¾ç¤ºæ‰€æœ‰ AI ä»»åŠ¡çš„çŠ¶æ€ã€è¿›åº¦å’Œæ—¥å¿—ã€‚

#### ç•Œé¢è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¯ AI ä»»åŠ¡ç›‘æ§                    [åˆ·æ–°] [è®¾ç½®]                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ç»Ÿè®¡æ¦‚æ ‡                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ æ€»ä»»åŠ¡   â”‚ è¿è¡Œä¸­   â”‚ å·²å®Œæˆ   â”‚ å¤±è´¥     â”‚ å·²å–æ¶ˆ   â”‚      â”‚
â”‚  â”‚   128    â”‚    3     â”‚   115    â”‚    8     â”‚    2     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                  â”‚
â”‚  è¿›è¡Œä¸­çš„ä»»åŠ¡                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ ğŸ”µ Issue #123: å®ç°ç”¨æˆ·è®¤è¯åŠŸèƒ½                          â”‚     â”‚
â”‚  â”‚                                                         â”‚     â”‚
â”‚  â”‚ åˆ†æ”¯: ai/issue-123    Worktree: .worktrees/issue-123   â”‚     â”‚
â”‚  â”‚                                                         â”‚     â”‚
â”‚  â”‚ è¿›åº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 60%                          â”‚     â”‚
â”‚  â”‚                                                         â”‚     â”‚
â”‚  â”‚ ğŸ“ æœ€è¿‘æ—¥å¿—:                                            â”‚     â”‚
â”‚  â”‚ [14:32:15] æ­£åœ¨åˆ†æéœ€æ±‚...                              â”‚     â”‚
â”‚  â”‚ [14:32:18] åˆ›å»ºè®¤è¯æœåŠ¡æ¨¡å—...                          â”‚     â”‚
â”‚  â”‚ [14:32:22] å®ç° JWT token éªŒè¯...                       â”‚     â”‚
â”‚  â”‚                                                         â”‚     â”‚
â”‚  â”‚ [æŸ¥çœ‹è¯¦æƒ…] [å–æ¶ˆä»»åŠ¡]                                    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                  â”‚
â”‚  å·²å®Œæˆçš„ä»»åŠ¡                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ âœ… Issue #122: æ·»åŠ æ—¥å¿—ç›‘æ§é¡µé¢           15åˆ†é’Ÿå‰      â”‚     â”‚
â”‚  â”‚ PR: #456 Â· 3 æ–‡ä»¶å˜æ›´ Â· +127 -23                       â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ âœ… Issue #121: ä¿®å¤å¹¶å‘æ§åˆ¶ bug            1å°æ—¶å‰       â”‚     â”‚
â”‚  â”‚ PR: #455 Â· 1 æ–‡ä»¶å˜æ›´ Â· +5 -2                          â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                  â”‚
â”‚  å¤±è´¥çš„ä»»åŠ¡                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ âŒ Issue #120: ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢               2å°æ—¶å‰      â”‚     â”‚
â”‚  â”‚ é”™è¯¯: Database connection timeout                       â”‚     â”‚
â”‚  â”‚ [é‡è¯•] [æŸ¥çœ‹æ—¥å¿—]                                        â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### WebSocket å®æ—¶æ›´æ–°

```typescript
// frontend/src/lib/websocket.ts
export class TaskWebSocket {
  private ws: WebSocket | null = null;
  private reconnectAttempts = 0;
  private maxReconnectAttempts = 5;

  connect(url: string, onMessage: (data: TaskUpdate) => void) {
    this.ws = new WebSocket(url);

    this.ws.onopen = () => {
      console.log('WebSocket connected');
      this.reconnectAttempts = 0;
    };

    this.ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      onMessage(data);
    };

    this.ws.onerror = (error) => {
      console.error('WebSocket error:', error);
    };

    this.ws.onclose = () => {
      console.log('WebSocket closed');
      this.reconnect();
    };
  }

  private reconnect() {
    if (this.reconnectAttempts < this.maxReconnectAttempts) {
      this.reconnectAttempts++;
      setTimeout(() => {
        console.log(`Reconnecting... Attempt ${this.reconnectAttempts}`);
        this.connect(this.url, this.onMessage);
      }, 2000 * this.reconnectAttempts);
    }
  }

  disconnect() {
    this.ws?.close();
  }
}
```

### 3.4 å®æ—¶æ—¥å¿—æµ

#### åŠŸèƒ½æè¿°

é€šè¿‡ WebSocket å®æ—¶æ¨é€ä»»åŠ¡æ‰§è¡Œæ—¥å¿—ï¼Œæ”¯æŒæŒ‰çº§åˆ«è¿‡æ»¤å’Œå…³é”®è¯æœç´¢ã€‚

#### æ ¸å¿ƒä»£ç 

```python
# app/api/websocket.py
from fastapi import APIRouter, WebSocket
from loguru import logger
import json

router = APIRouter()

class WebSocketManager:
    def __init__(self):
        self.active_connections: list[WebSocket] = []

    async def connect(self, websocket: WebSocket):
        await websocket.accept()
        self.active_connections.append(websocket)

    def disconnect(self, websocket: WebSocket):
        self.active_connections.remove(websocket)

    async def broadcast(self, message: dict):
        for connection in self.active_connections:
            try:
                await connection.send_json(message)
            except:
                await self.close(connection)

    async def close(self, websocket: WebSocket):
        try:
            await websocket.close()
        except:
            pass

manager = WebSocketManager()

@router.websocket("/ws/tasks")
async def task_websocket(websocket: WebSocket):
    await manager.connect(websocket)
    try:
        while True:
            # ä¿æŒè¿æ¥æ´»è·ƒ
            data = await websocket.receive_text()
            # å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼ˆå¦‚è®¢é˜…ç‰¹å®šä»»åŠ¡ï¼‰
    except:
        manager.disconnect(websocket)

# æ—¥å¿—å¤„ç†å™¨
async def log_to_websocket(message: dict):
    """å°†æ—¥å¿—æ¨é€åˆ°æ‰€æœ‰ WebSocket è¿æ¥"""
    await manager.broadcast({
        'type': 'log',
        'data': message
    })

# åœ¨ task_service.py ä¸­ä½¿ç”¨
async def execute_task(task_id: str):
    async for log_line in stream_claude_output():
        await log_to_websocket({
            'task_id': task_id,
            'level': 'info',
            'message': log_line,
            'timestamp': datetime.now().isoformat(),
        })
```

---

## 4. å®æ–½æ­¥éª¤

### 4.1 ç¬¬ä¸€é˜¶æ®µï¼šGit Worktree æ”¯æŒï¼ˆç¬¬ 1 å‘¨ï¼‰

#### ç›®æ ‡
å®ç° Git Worktree å¹¶è¡Œå¼€å‘æ ¸å¿ƒåŠŸèƒ½

#### ä»»åŠ¡æ¸…å•

- [ ] åˆ›å»º `worktree_service.py`
  - [ ] `create_worktree()` æ–¹æ³•
  - [ ] `cleanup_worktree()` æ–¹æ³•
  - [ ] `list_active_worktrees()` æ–¹æ³•
  - [ ] `cleanup_orphaned_worktrees()` æ–¹æ³•

- [ ] ä¿®æ”¹ `git_service.py`
  - [ ] é›†æˆ WorktreeService
  - [ ] æ›´æ–°åˆ†æ”¯åˆ›å»ºé€»è¾‘

- [ ] ä¿®æ”¹ `claude_service.py`
  - [ ] æ”¯æŒè‡ªå®šä¹‰å·¥ä½œç›®å½•å‚æ•°
  - [ ] åœ¨ Worktree ä¸­æ‰§è¡Œ claude-code

- [ ] ä¿®æ”¹ `task_service.py`
  - [ ] æ·»åŠ å¹¶å‘æ§åˆ¶ï¼ˆé…ç½®æœ€å¤§å¹¶è¡Œä»»åŠ¡æ•°ï¼‰
  - [ ] ä»»åŠ¡å¤±è´¥æ—¶è‡ªåŠ¨æ¸…ç† Worktree

- [ ] æ›´æ–°é…ç½®æ–‡ä»¶
  - [ ] æ·»åŠ  `worktree.enabled` é…ç½®
  - [ ] æ·»åŠ  `worktree.max_concurrent` é…ç½®
  - [ ] æ·»åŠ  `worktree.auto_cleanup` é…ç½®

#### éªŒæ”¶æ ‡å‡†
- [ ] èƒ½ä¸ºä¸åŒ Issue åˆ›å»ºç‹¬ç«‹çš„ Worktree
- [ ] å¤šä¸ªä»»åŠ¡èƒ½åœ¨ä¸åŒ Worktree ä¸­å¹¶è¡Œæ‰§è¡Œ
- [ ] ä»»åŠ¡å®Œæˆåè‡ªåŠ¨æ¸…ç† Worktree
- [ ] èƒ½æ£€æµ‹å¹¶æ¸…ç†å­¤ç«‹çš„ Worktree

### 4.2 ç¬¬äºŒé˜¶æ®µï¼šå‰ç«¯å¼€å‘ï¼ˆç¬¬ 2-3 å‘¨ï¼‰

#### ç›®æ ‡
æ„å»º React å‰ç«¯åº”ç”¨

#### ä»»åŠ¡æ¸…å•

**Week 2: åŸºç¡€æ¶æ„å’Œæ ¸å¿ƒé¡µé¢**

- [ ] é¡¹ç›®åˆå§‹åŒ–
  - [ ] ä½¿ç”¨ Vite åˆ›å»º React + TypeScript é¡¹ç›®
  - [ ] é…ç½® TailwindCSS
  - [ ] é…ç½® ESLint + Prettier

- [ ] çŠ¶æ€ç®¡ç†
  - [ ] è®¾ç½® Zustand store
  - [ ] å®šä¹‰çŠ¶æ€ç±»å‹ï¼ˆtasks, config, worktreesï¼‰

- [ ] API å®¢æˆ·ç«¯
  - [ ] å°è£… Axios å®¢æˆ·ç«¯
  - [ ] æ·»åŠ è¯·æ±‚/å“åº”æ‹¦æˆªå™¨
  - [ ] å®ç° React Query é›†æˆ

- [ ] WebSocket å®¢æˆ·ç«¯
  - [ ] å°è£… WebSocket è¿æ¥
  - [ ] å®ç°è‡ªåŠ¨é‡è¿
  - [ ] å®ç°å¿ƒè·³æœºåˆ¶

- [ ] æ ¸å¿ƒé¡µé¢
  - [ ] Dashboard ä»ªè¡¨æ¿
  - [ ] Tasks ä»»åŠ¡åˆ—è¡¨é¡µ
  - [ ] Settings è®¾ç½®é¡µ

**Week 3: é«˜çº§åŠŸèƒ½å’Œä¼˜åŒ–**

- [ ] é…ç½®å‘å¯¼
  - [ ] WelcomeStep æ¬¢è¿é¡µ
  - [ ] GitHubConfigStep GitHub é…ç½®
  - [ ] RepoPathStep ä»“åº“è·¯å¾„éªŒè¯
  - [ ] ClaudeAPIStep Claude API é…ç½®
  - [ ] CompletionStep å®Œæˆé¡µ

- [ ] ä»»åŠ¡ç›‘æ§
  - [ ] TaskCard ä»»åŠ¡å¡ç‰‡ç»„ä»¶
  - [ ] TaskMonitor ä»»åŠ¡ç›‘æ§é¢æ¿
  - [ ] LogViewer æ—¥å¿—æŸ¥çœ‹å™¨
  - [ ] å®æ—¶çŠ¶æ€æ›´æ–°

- [ ] Worktree ç®¡ç†
  - [ ] WorktreeList Worktree åˆ—è¡¨
  - [ ] WorktreeStatus çŠ¶æ€æ˜¾ç¤º
  - [ ] æ‰‹åŠ¨æ¸…ç†åŠŸèƒ½

- [ ] UI ä¼˜åŒ–
  - [ ] å“åº”å¼å¸ƒå±€
  - [ ] æš—è‰²æ¨¡å¼æ”¯æŒ
  - [ ] åŠ è½½çŠ¶æ€å’Œéª¨æ¶å±
  - [ ] é”™è¯¯å¤„ç†å’Œæç¤º

#### éªŒæ”¶æ ‡å‡†
- [ ] é…ç½®å‘å¯¼æµç¨‹å®Œæ•´å¯ç”¨
- [ ] èƒ½å®æ—¶æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€å’Œæ—¥å¿—
- [ ] èƒ½æŸ¥çœ‹å’Œç®¡ç† Worktree
- [ ] UI å“åº”å¼ï¼Œæ”¯æŒç§»åŠ¨ç«¯

### 4.3 ç¬¬ä¸‰é˜¶æ®µï¼šAPI å¼€å‘ï¼ˆç¬¬ 2-3 å‘¨ï¼Œä¸å‰ç«¯å¹¶è¡Œï¼‰

#### ç›®æ ‡
å¼€å‘ RESTful API å’Œ WebSocket æ¥å£

#### ä»»åŠ¡æ¸…å•

- [ ] é…ç½®ç®¡ç† API (`/api/config`)
  - [ ] `GET /api/config` - è·å–å½“å‰é…ç½®
  - [ ] `POST /api/config/validate` - éªŒè¯é…ç½®
  - [ ] `POST /api/config/save` - ä¿å­˜é…ç½®
  - [ ] `POST /api/config/webhook` - ç”Ÿæˆ Webhook URL

- [ ] ä»»åŠ¡ç®¡ç† API (`/api/tasks`)
  - [ ] `GET /api/tasks` - è·å–ä»»åŠ¡åˆ—è¡¨
  - [ ] `GET /api/tasks/:id` - è·å–ä»»åŠ¡è¯¦æƒ…
  - [ ] `POST /api/tasks/:id/cancel` - å–æ¶ˆä»»åŠ¡
  - [ ] `POST /api/tasks/:id/retry` - é‡è¯•å¤±è´¥ä»»åŠ¡
  - [ ] `GET /api/tasks/:id/logs` - è·å–ä»»åŠ¡æ—¥å¿—

- [ ] Worktree API (`/api/worktrees`)
  - [ ] `GET /api/worktrees` - åˆ—å‡ºæ‰€æœ‰ Worktree
  - [ ] `DELETE /api/worktrees/:id` - åˆ é™¤æŒ‡å®š Worktree
  - [ ] `POST /api/worktrees/cleanup` - æ¸…ç†å­¤ç«‹ Worktree

- [ ] WebSocket ç«¯ç‚¹
  - [ ] `/ws/tasks` - ä»»åŠ¡çŠ¶æ€æ›´æ–°
  - [ ] `/ws/logs` - æ—¥å¿—æµ
  - [ ] å®ç°è¿æ¥ç®¡ç†å’Œå¹¿æ’­

- [ ] API æ–‡æ¡£
  - [ ] é›†æˆ Swagger/OpenAPI
  - [ ] æ·»åŠ è¯¦ç»†çš„ API æ³¨é‡Š

#### éªŒæ”¶æ ‡å‡†
- [ ] æ‰€æœ‰ API ç«¯ç‚¹æ­£å¸¸å·¥ä½œ
- [ ] WebSocket è¿æ¥ç¨³å®š
- [ ] API æ–‡æ¡£å®Œæ•´
- [ ] é”™è¯¯å¤„ç†å®Œå–„

### 4.4 ç¬¬å››é˜¶æ®µï¼šæ‰“åŒ…å’Œåˆ†å‘ï¼ˆç¬¬ 4 å‘¨ï¼‰

#### ç›®æ ‡
å®ç° NPX ä¸€é”®å®‰è£…å’Œè¿è¡Œ

#### ä»»åŠ¡æ¸…å•

- [ ] NPX åŒ…è£…å™¨
  - [ ] åˆ›å»º `npx-cli/bin/cli.js`
  - [ ] å®ç°å¹³å°æ£€æµ‹
  - [ ] å®ç°åç«¯å¯åŠ¨é€»è¾‘
  - [ ] å®ç°å‰ç«¯å¯åŠ¨é€»è¾‘
  - [ ] å®ç°è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨

- [ ] PyInstaller æ‰“åŒ…
  - [ ] åˆ›å»º PyInstaller é…ç½®
  - [ ] æ‰“åŒ… Python åç«¯
  - [ ] åµŒå…¥å‰ç«¯é™æ€æ–‡ä»¶
  - [ ] æµ‹è¯•å•æ–‡ä»¶è¿è¡Œ

- [ ] NPX åŒ…é…ç½®
  - [ ] é…ç½® `package.json`
  - [ ] è®¾ç½® `bin` å…¥å£
  - [ ] é…ç½® `files` ç™½åå•
  - [ ] ç¼–å†™ README

- [ ] æ„å»ºè„šæœ¬
  - [ ] `scripts/build.sh` - ä¸»æ„å»ºè„šæœ¬
  - [ ] `scripts/package-npx.sh` - NPX æ‰“åŒ…

- [ ] æµ‹è¯•
  - [ ] æœ¬åœ° NPX å®‰è£…æµ‹è¯•
  - [ ] è·¨å¹³å°æµ‹è¯•ï¼ˆmacOS/Linuxï¼‰
  - [ ] é¦–æ¬¡è¿è¡Œæµ‹è¯•

#### éªŒæ”¶æ ‡å‡†
- [ ] `npx kaka-dev` èƒ½æˆåŠŸå¯åŠ¨
- [ ] è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨åˆ°é…ç½®å‘å¯¼
- [ ] é…ç½®å®Œæˆåèƒ½æ¥æ”¶ Webhook
- [ ] åœ¨ macOS å’Œ Linux ä¸Šéƒ½èƒ½è¿è¡Œ

### 4.5 ç¬¬äº”é˜¶æ®µï¼šæµ‹è¯•å’Œæ–‡æ¡£ï¼ˆç¬¬ 4 å‘¨ï¼‰

#### ç›®æ ‡
å®Œå–„æµ‹è¯•å’Œæ–‡æ¡£

#### ä»»åŠ¡æ¸…å•

- [ ] å•å…ƒæµ‹è¯•
  - [ ] `test_worktree_service.py`
  - [ ] `test_task_service.py`
  - [ ] `test_api.py`

- [ ] é›†æˆæµ‹è¯•
  - [ ] ç«¯åˆ°ç«¯å·¥ä½œæµæµ‹è¯•
  - [ ] å¹¶å‘ä»»åŠ¡æµ‹è¯•
  - [ ] Worktree æ¸…ç†æµ‹è¯•

- [ ] æ–‡æ¡£
  - [ ] æ›´æ–° `README.md`
  - [ ] ç¼–å†™ `INSTALLATION.md`
  - [ ] ç¼–å†™ `API.md`
  - [ ] ç¼–å†™ `ARCHITECTURE.md`

- [ ] å‘å¸ƒå‡†å¤‡
  - [ ] ç‰ˆæœ¬å·ç®¡ç†
  - [ ] Changelog
  - [ ] å‘å¸ƒåˆ° NPM
  - [ ] GitHub Release

#### éªŒæ”¶æ ‡å‡†
- [ ] æµ‹è¯•è¦†ç›–ç‡ > 80%
- [ ] æ–‡æ¡£å®Œæ•´æ¸…æ™°
- [ ] é¦–æ¬¡ç”¨æˆ·èƒ½åœ¨ 5 åˆ†é’Ÿå†…å®Œæˆé…ç½®

---

## 5. æŠ€æœ¯ç»†èŠ‚

### 5.1 å¹¶å‘æ§åˆ¶å®ç°

```python
# app/services/task_service.py
import asyncio
from asyncio import Semaphore

class TaskService:
    def __init__(self, max_concurrent: int = 3):
        self.semaphore = Semaphore(max_concurrent)
        self.running_tasks: dict[str, asyncio.Task] = {}

    async def execute_task(self, task_id: str, issue: Issue):
        """æ‰§è¡Œä»»åŠ¡ï¼ˆæ”¯æŒå¹¶å‘æ§åˆ¶ï¼‰"""

        async def _execute():
            async with self.semaphore:
                # 1. åˆ›å»º Worktree
                worktree_path = await self.worktree_service.create_worktree(
                    issue_id=issue.number,
                    branch_name=f"ai/issue-{issue.number}"
                )

                try:
                    # 2. åœ¨ Worktree ä¸­æ‰§è¡Œ AI å¼€å‘
                    await self.claude_service.execute(
                        work_dir=worktree_path,
                        prompt=issue.body
                    )

                    # 3. æäº¤å¹¶æ¨é€
                    await self.git_service.commit_and_push(worktree_path)

                    # 4. åˆ›å»º PR
                    await self.github_service.create_pr(issue)

                finally:
                    # 5. æ¸…ç† Worktree
                    await self.worktree_service.cleanup_worktree(issue.number)

        # åˆ›å»ºå¼‚æ­¥ä»»åŠ¡
        task = asyncio.create_task(_execute())
        self.running_tasks[task_id] = task

        try:
            await task
        finally:
            del self.running_tasks[task_id]
```

### 5.2 é…ç½®ç®¡ç†å‡çº§

```python
# app/config.py (æ–°å¢)
from pydantic import Field

class WorktreeConfig(BaseSettings):
    """Worktree é…ç½®"""
    enabled: bool = True
    max_concurrent: int = Field(default=3, ge=1, le=10)
    auto_cleanup: bool = True
    worktrees_dir: str = ".worktrees"
    cleanup_on_completion: bool = True

class FrontendConfig(BaseSettings):
    """å‰ç«¯é…ç½®"""
    enabled: bool = True
    port: int = 3000
    host: str = "127.0.0.1"
    auto_open_browser: bool = True

class WebSocketConfig(BaseSettings):
    """WebSocket é…ç½®"""
    enabled: bool = True
    heartbeat_interval: int = 30
    max_connections: int = 100

# æ›´æ–°ä¸»é…ç½®
class AppConfig(BaseSettings):
    # ... ç°æœ‰é…ç½® ...
    worktree: WorktreeConfig = Field(default_factory=WorktreeConfig)
    frontend: FrontendConfig = Field(default_factory=FrontendConfig)
    websocket: WebSocketConfig = Field(default_factory=WebSocketConfig)
```

### 5.3 å‰ç«¯çŠ¶æ€ç®¡ç†

```typescript
// frontend/src/store/useStore.ts
import { create } from 'zustand';
import { Task, Worktree, Config } from '@/types';

interface StoreState {
  // çŠ¶æ€
  tasks: Task[];
  worktrees: Worktree[];
  config: Config | null;
  isConnected: boolean;

  // Actions
  setTasks: (tasks: Task[]) => void;
  updateTask: (taskId: string, updates: Partial<Task>) => void;
  setWorktrees: (worktrees: Worktree[]) => void;
  setConfig: (config: Config) => void;
  setConnected: (connected: boolean) => void;
}

export const useStore = create<StoreState>((set) => ({
  // åˆå§‹çŠ¶æ€
  tasks: [],
  worktrees: [],
  config: null,
  isConnected: false,

  // Actions
  setTasks: (tasks) => set({ tasks }),
  updateTask: (taskId, updates) =>
    set((state) => ({
      tasks: state.tasks.map((task) =>
        task.id === taskId ? { ...task, ...updates } : task
      ),
    })),
  setWorktrees: (worktrees) => set({ worktrees }),
  setConfig: (config) => set({ config }),
  setConnected: (isConnected) => set({ isConnected }),
}));
```

---

## 6. æµ‹è¯•è®¡åˆ’

### 6.1 å•å…ƒæµ‹è¯•

```python
# tests/test_worktree_service.py
import pytest
from pathlib import Path
from app.services.worktree_service import WorktreeService

@pytest.fixture
def worktree_service(tmp_path):
    """åˆ›å»ºæµ‹è¯•ç”¨çš„ WorktreeService"""
    # åˆå§‹åŒ– git ä»“åº“
    repo_path = tmp_path / "test_repo"
    repo_path.mkdir()

    import subprocess
    subprocess.run(["git", "init"], cwd=repo_path, check=True)
    subprocess.run(
        ["git", "config", "user.email", "test@example.com"],
        cwd=repo_path,
        check=True
    )
    subprocess.run(
        ["git", "config", "user.name", "Test User"],
        cwd=repo_path,
        check=True
    )

    # åˆ›å»ºåˆå§‹æäº¤
    (repo_path / "README.md").write_text("# Test")
    subprocess.run(["git", "add", "."], cwd=repo_path, check=True)
    subprocess.run(
        ["git", "commit", "-m", "Initial commit"],
        cwd=repo_path,
        check=True
    )

    return WorktreeService(str(repo_path))

def test_create_worktree(worktree_service):
    """æµ‹è¯•åˆ›å»º Worktree"""
    worktree_path = worktree_service.create_worktree(
        issue_id=123,
        branch_name="ai/issue-123"
    )

    assert worktree_path.exists()
    assert worktree_path.name == "issue-123"

def test_cleanup_worktree(worktree_service):
    """æµ‹è¯•æ¸…ç† Worktree"""
    worktree_service.create_worktree(
        issue_id=123,
        branch_name="ai/issue-123"
    )
    worktree_service.cleanup_worktree(123)

    worktrees = worktree_service.list_active_worktrees()
    assert len(worktrees) == 0

def test_list_active_worktrees(worktree_service):
    """æµ‹è¯•åˆ—å‡ºæ´»è·ƒ Worktree"""
    worktree_service.create_worktree(
        issue_id=123,
        branch_name="ai/issue-123"
    )
    worktree_service.create_worktree(
        issue_id=124,
        branch_name="ai/issue-124"
    )

    worktrees = worktree_service.list_active_worktrees()
    assert len(worktrees) == 2

@pytest.mark.asyncio
async def test_concurrent_worktree_creation(worktree_service):
    """æµ‹è¯•å¹¶å‘åˆ›å»º Worktree"""
    import asyncio

    async def create(issue_id):
        return worktree_service.create_worktree(
            issue_id=issue_id,
            branch_name=f"ai/issue-{issue_id}"
        )

    results = await asyncio.gather(
        create(1), create(2), create(3)
    )

    assert len(results) == 3
    worktrees = worktree_service.list_active_worktrees()
    assert len(worktrees) == 3
```

### 6.2 é›†æˆæµ‹è¯•

```python
# tests/test_integration.py
import pytest
from fastapi.testclient import TestClient
from app.main import app

client = TestClient(app)

def test_complete_workflow():
    """æµ‹è¯•å®Œæ•´çš„å·¥ä½œæµ"""
    # 1. é…ç½® API
    response = client.post("/api/config/save", json={
        "github_token": "test_token",
        "repo_owner": "test_owner",
        "repo_name": "test_repo",
        "repo_path": "/tmp/test_repo",
        "anthropic_api_key": "test_key"
    })
    assert response.status_code == 200

    # 2. Webhook è§¦å‘
    webhook_payload = {
        "action": "labeled",
        "issue": {
            "number": 123,
            "body": "Implement feature X",
            "title": "Feature X"
        },
        "label": {"name": "ai-dev"}
    }
    response = client.post(
        "/webhook/github",
        json=webhook_payload,
        headers={"X-Hub-Signature-256": "test_signature"}
    )
    assert response.status_code == 200

    # 3. æ£€æŸ¥ä»»åŠ¡åˆ›å»º
    tasks = client.get("/api/tasks").json()
    assert len(tasks) > 0
    assert tasks[0]["issue_number"] == 123

    # 4. æ£€æŸ¥ Worktree åˆ›å»º
    worktrees = client.get("/api/worktrees").json()
    assert any("issue-123" in wt["path"] for wt in worktrees)
```

### 6.3 ç«¯åˆ°ç«¯æµ‹è¯•

```typescript
// frontend/tests/e2e/config-wizard.spec.ts
import { test, expect } from '@playwright/test';

test.describe('é…ç½®å‘å¯¼', () => {
  test('å®Œæˆé…ç½®æµç¨‹', async ({ page }) => {
    await page.goto('http://localhost:3000');

    // æ­¥éª¤ 1: æ¬¢è¿
    await page.click('text=å¼€å§‹é…ç½®');
    await expect(page).toHaveURL(/.*step=2/);

    // æ­¥éª¤ 2: GitHub é…ç½®
    await page.fill('[name="githubToken"]', 'ghp_test_token');
    await page.fill('[name="repoOwner"]', 'test_owner');
    await page.fill('[name="repoName"]', 'test_repo');
    await page.click('text=ä¸‹ä¸€æ­¥');

    // æ­¥éª¤ 3: ä»“åº“è·¯å¾„
    await page.fill('[name="repoPath"]', '/tmp/test_repo');
    await page.click('text=ä¸‹ä¸€æ­¥');
    await expect(page.locator('text=è·¯å¾„éªŒè¯é€šè¿‡')).toBeVisible();

    // æ­¥éª¤ 4: Claude API
    await page.fill('[name="anthropicApiKey"]', 'sk-ant-test');
    await page.click('text=å®Œæˆ');

    // æ­¥éª¤ 5: å®Œæˆé¡µé¢
    await expect(page.locator('text=é…ç½®å®Œæˆ')).toBeVisible();
    await expect(page.locator('text=Webhook URL')).toBeVisible();
  });
});
```

---

## 7. éƒ¨ç½²æ–¹æ¡ˆ

### 7.1 æœ¬åœ°å¼€å‘

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/your-username/kaka.git
cd kaka

# å®‰è£… Python ä¾èµ–
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt

# å®‰è£…å‰ç«¯ä¾èµ–
cd frontend
npm install
npm run dev  # å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨

# å¯åŠ¨åç«¯ï¼ˆå¦ä¸€ä¸ªç»ˆç«¯ï¼‰
cd ..
./scripts/dev.sh
```

### 7.2 NPX å®‰è£…

```bash
# æ–¹å¼ 1: ç›´æ¥è¿è¡Œï¼ˆæ¨èï¼‰
npx kaka-dev

# æ–¹å¼ 2: å…¨å±€å®‰è£…
npm install -g kaka-dev
kaka-dev

# é¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨ï¼š
# 1. æ‰“å¼€æµè§ˆå™¨
# 2. æ˜¾ç¤ºé…ç½®å‘å¯¼
# 3. å¼•å¯¼å®Œæˆé…ç½®
# 4. å¯åŠ¨ Webhook æœåŠ¡
```

### 7.3 Docker éƒ¨ç½²

```dockerfile
# Dockerfile
FROM python:3.11-slim

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    git \
    nodejs \
    npm \
    && rm -rf /var/lib/apt/lists/*

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# å¤åˆ¶åº”ç”¨ä»£ç 
COPY app/ ./app/
COPY config/ ./config/
COPY frontend/dist ./frontend/dist

# æš´éœ²ç«¯å£
EXPOSE 8000 3000

# å¯åŠ¨è„šæœ¬
COPY docker-entrypoint.sh /
RUN chmod +x /docker-entrypoint.sh

ENTRYPOINT ["/docker-entrypoint.sh"]
```

```bash
# docker-compose.yml
version: '3.8'

services:
  kaka-dev:
    build: .
    ports:
      - "8000:8000"
      - "3000:3000"
    environment:
      - GITHUB_TOKEN=${GITHUB_TOKEN}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - REPO_PATH=/workspace
    volumes:
      - ./data:/app/data
      - ${LOCAL_REPO_PATH}:/workspace
    restart: unless-stopped
```

### 7.4 ç”Ÿäº§ç¯å¢ƒ

```bash
# ä½¿ç”¨ systemd ç®¡ç†
# /etc/systemd/system/kaka-dev.service

[Unit]
Description=AI Dev Scheduler Service
After=network.target

[Service]
Type=simple
User=kaka-dev
WorkingDirectory=/opt/kaka-dev
Environment="PATH=/opt/kaka-dev/venv/bin"
ExecStart=/opt/kaka-dev/venv/bin/python app/main.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

---

## 8. é£é™©ç®¡ç†

### 8.1 æŠ€æœ¯é£é™©

| é£é™© | å¯èƒ½æ€§ | å½±å“ | ç¼“è§£æªæ–½ |
|------|--------|------|----------|
| **Git Worktree å…¼å®¹æ€§é—®é¢˜** | ä¸­ | ä¸­ | æµ‹è¯•å¤šç‰ˆæœ¬ Gitï¼Œæä¾›ç‰ˆæœ¬æ£€æŸ¥ |
| **å¹¶å‘ä»»åŠ¡å†²çª** | ä¸­ | é«˜ | ä½¿ç”¨æ–‡ä»¶é”å’Œæ•°æ®åº“äº‹åŠ¡ |
| **WebSocket è¿æ¥ä¸ç¨³å®š** | ä½ | ä¸­ | å®ç°è‡ªåŠ¨é‡è¿å’Œå¿ƒè·³æœºåˆ¶ |
| **å‰ç«¯æ„å»ºä½“ç§¯è¿‡å¤§** | ä½ | ä½ | ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½ |

### 8.2 å¼€å‘é£é™©

| é£é™© | å¯èƒ½æ€§ | å½±å“ | ç¼“è§£æªæ–½ |
|------|--------|------|----------|
| **å¼€å‘å‘¨æœŸå»¶é•¿** | ä¸­ | ä¸­ | é‡‡ç”¨æ•æ·å¼€å‘ï¼Œä¼˜å…ˆæ ¸å¿ƒåŠŸèƒ½ |
| **API å˜æ›´å¯¼è‡´å‰ç«¯è¿”å·¥** | ä½ | ä¸­ | å…ˆå®š API å¥‘çº¦ï¼Œä½¿ç”¨ Mock |
| **æµ‹è¯•è¦†ç›–ä¸è¶³** | ä¸­ | ä½ | TDD å¼€å‘ï¼ŒæŒç»­é›†æˆ |

### 8.3 éƒ¨ç½²é£é™©

| é£é™© | å¯èƒ½æ€§ | å½±å“ | ç¼“è§£æªæ–½ |
|------|--------|------|----------|
| **è·¨å¹³å°å…¼å®¹æ€§é—®é¢˜** | ä¸­ | é«˜ | åœ¨ä¸»æµå¹³å°å……åˆ†æµ‹è¯• |
| **PyInstaller æ‰“åŒ…å¤±è´¥** | ä½ | é«˜ | å¤‡é€‰ shiv æ‰“åŒ…æ–¹æ¡ˆ |
| **NPX ç¼“å­˜é—®é¢˜** | ä½ | ä½ | ç‰ˆæœ¬åŒ–ç¼“å­˜ç›®å½• |

### 8.4 ç”¨æˆ·é£é™©

| é£é™© | å¯èƒ½æ€§ | å½±å“ | ç¼“è§£æªæ–½ |
|------|--------|------|----------|
| **é…ç½®é”™è¯¯å¯¼è‡´å¤±è´¥** | é«˜ | ä¸­ | æä¾›é…ç½®éªŒè¯å’Œè¯¦ç»†æç¤º |
| **Worktree æ®‹ç•™å ç”¨ç©ºé—´** | ä¸­ | ä½ | è‡ªåŠ¨æ¸…ç†å’Œæ‰‹åŠ¨æ¸…ç†å·¥å…· |
| **GitHub API é™æµ** | ä¸­ | ä¸­ | å®ç°é€Ÿç‡é™åˆ¶æ£€æµ‹å’Œé˜Ÿåˆ— |

---

## 9. æˆåŠŸæŒ‡æ ‡

### 9.1 æŠ€æœ¯æŒ‡æ ‡

- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- âœ… API å“åº”æ—¶é—´ < 200ms (P95)
- âœ… WebSocket è¿æ¥æˆåŠŸç‡ > 99%
- âœ… å¹¶å‘ä»»åŠ¡æ•° â‰¥ 3

### 9.2 ç”¨æˆ·ä½“éªŒæŒ‡æ ‡

- âœ… é¦–æ¬¡é…ç½®æ—¶é—´ < 5 åˆ†é’Ÿ
- âœ… ä»»åŠ¡åˆ›å»ºåˆ° Worktree åˆ›å»º < 2 ç§’
- âœ… é…ç½®å‘å¯¼å®Œæˆç‡ > 90%
- âœ… æ—¥å¿—å®æ—¶å»¶è¿Ÿ < 500ms

### 9.3 ç¨³å®šæ€§æŒ‡æ ‡

- âœ… æœåŠ¡å¯ç”¨ç‡ > 99%
- âœ… ä»»åŠ¡å¤±è´¥ç‡ < 5%
- âœ… Worktree æ¸…ç†æˆåŠŸç‡ > 95%
- âœ… å†…å­˜ä½¿ç”¨ < 500MB (ç©ºé—²)

---

## 10. åç»­ä¼˜åŒ–

### 10.1 çŸ­æœŸä¼˜åŒ–ï¼ˆ1-2 ä¸ªæœˆï¼‰

- [ ] æ·»åŠ ä»»åŠ¡ä¼˜å…ˆçº§é˜Ÿåˆ—
- [ ] æ”¯æŒ Docker å®¹å™¨éš”ç¦»ï¼ˆæ›¿ä»£ Worktreeï¼‰
- [ ] å®ç°ä»»åŠ¡æ¨¡æ¿å’Œé¢„è®¾
- [ ] æ·»åŠ æ›´å¤šé€šçŸ¥æ¸ é“ï¼ˆSlackã€é’‰é’‰ï¼‰

### 10.2 ä¸­æœŸä¼˜åŒ–ï¼ˆ3-6 ä¸ªæœˆï¼‰

- [ ] æ€§èƒ½ç“¶é¢ˆæ¨¡å—è¿ç§»åˆ° Rustï¼ˆPyO3ï¼‰
- [ ] å®ç°åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦
- [ ] æ·»åŠ ä»»åŠ¡ä¾èµ–å’Œç¼–æ’
- [ ] æ”¯æŒè‡ªå®šä¹‰ AI æ¨¡å‹

### 10.3 é•¿æœŸè§„åˆ’ï¼ˆ6-12 ä¸ªæœˆï¼‰

- [ ] å®Œæ•´çš„ Rust é‡å†™ï¼ˆå¦‚æœæ€§èƒ½æˆä¸ºç“¶é¢ˆï¼‰
- [ ] SaaS å¤šç§Ÿæˆ·ç‰ˆæœ¬
- [ ] AI èƒ½åŠ›è¯„ä¼°å’Œè´¨é‡ç›‘æ§
- [ ] æ’ä»¶ç³»ç»Ÿå’Œæ‰©å±•å¸‚åœº

---

## 11. å‚è€ƒèµ„æ–™

### 11.1 æŠ€æœ¯æ–‡æ¡£

- [FastAPI å®˜æ–¹æ–‡æ¡£](https://fastapi.tiangolo.com/)
- [Git Worktree æ–‡æ¡£](https://git-scm.com/docs/git-worktree)
- [React æ–‡æ¡£](https://react.dev/)
- [Zustand æ–‡æ¡£](https://docs.pmnd.rs/zustand)

### 11.2 ç›¸å…³é¡¹ç›®

- [vibe-kanban](https://github.com/BloopAI/vibe-kanban) - æ¶æ„å‚è€ƒ
- [Claude Code](https://github.com/anthropics/claude-code) - AI å¼€å‘å·¥å…·

### 11.3 æœ€ä½³å®è·µ

- [FastAPI é¡¹ç›®ç»“æ„](https://fastapi.tiangolo.com/tutorial/)
- [React TypeScript æ¨¡å¼](https://react-typescript-cheatsheet.netlify.app/)

---

## é™„å½• Aï¼šé…ç½®æ–‡ä»¶ç¤ºä¾‹

```yaml
# config/config.yaml
server:
  host: "0.0.0.0"
  port: 8000
  workers: 4

github:
  token: "${GITHUB_TOKEN}"
  repo_owner: "${GITHUB_REPO_OWNER}"
  repo_name: "${GITHUB_REPO_NAME}"
  webhook_secret: "${GITHUB_WEBHOOK_SECRET}"

repository:
  path: "${REPO_PATH}"
  default_branch: "main"
  branch_template: "ai/issue-{issue_number}"

claude:
  anthropic_api_key: "${ANTHROPIC_API_KEY}"
  timeout: 600
  max_retries: 3

worktree:
  enabled: true
  max_concurrent: 3
  auto_cleanup: true
  worktrees_dir: ".worktrees"
  cleanup_on_completion: true

frontend:
  enabled: true
  port: 3000
  host: "127.0.0.1"
  auto_open_browser: true

websocket:
  enabled: true
  heartbeat_interval: 30
  max_connections: 100

logging:
  level: "INFO"
  file: "logs/kaka-dev.log"
  rotation: "100 MB"
  retention: "30 days"
```

---

## é™„å½• Bï¼šAPI ç¤ºä¾‹

```bash
# è·å–ä»»åŠ¡åˆ—è¡¨
GET /api/tasks

# å“åº”
{
  "tasks": [
    {
      "id": "task_123",
      "issue_number": 123,
      "status": "running",
      "branch": "ai/issue-123",
      "worktree_path": ".worktrees/issue-123",
      "created_at": "2026-01-10T14:30:00Z",
      "updated_at": "2026-01-10T14:35:00Z",
      "progress": 60,
      "logs": [
        {
          "level": "info",
          "message": "æ­£åœ¨åˆ†æéœ€æ±‚...",
          "timestamp": "2026-01-10T14:32:15Z"
        }
      ]
    }
  ]
}

# å–æ¶ˆä»»åŠ¡
POST /api/tasks/task_123/cancel

# é‡è¯•å¤±è´¥ä»»åŠ¡
POST /api/tasks/task_124/retry

# è·å– Worktree åˆ—è¡¨
GET /api/worktrees

# å“åº”
{
  "worktrees": [
    {
      "path": ".worktrees/issue-123",
      "branch": "ai/issue-123",
      "commit": "abc123",
      "created_at": "2026-01-10T14:30:00Z"
    }
  ]
}

# æ¸…ç†å­¤ç«‹ Worktree
POST /api/worktrees/cleanup
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2026-01-10
**ç»´æŠ¤è€…**: AI Dev Scheduler Team
