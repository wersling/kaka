# AI 开发调度服务 (ai-dev-scheduler)

## 项目概述

AI 开发调度服务是一个基于 Python 的自动化开发工作流系统，通过接收 GitHub Webhook 事件（Issue 标签/评论触发），调用本地 Claude Code CLI 进行 AI 开发，实现自动化的测试、提交和 PR 创建。

## 技术栈

- **Python 3.11+** - 编程语言
- **FastAPI** - 高性能异步 Web 框架
- **Claude Code CLI** - AI 开发工具
- **PyGithub** - GitHub API 客户端
- **GitPython** - Git 操作库
- **Pydantic** - 数据验证
- **Docker** - 容器化部署
- **Uvicorn** - ASGI 服务器
- **PyYAML** - 配置管理

## 项目结构

```
ai-dev-scheduler/
├── app/
│   ├── main.py                 # FastAPI 应用入口
│   ├── config.py               # 配置管理
│   ├── models/                 # Pydantic 数据模型
│   │   └── github_events.py    # GitHub 事件模型
│   ├── services/               # 核心业务服务
│   │   ├── webhook_handler.py  # Webhook 处理
│   │   ├── claude_service.py   # Claude Code CLI 调用
│   │   ├── git_service.py      # Git 操作
│   │   └── github_service.py   # GitHub API 操作
│   └── utils/                  # 工具函数
│       ├── logger.py           # 日志工具
│       └── validators.py       # Webhook 签名验证
├── config/
│   └── config.yaml             # 配置文件
├── scripts/
│   ├── setup.sh                # 初始化脚本
│   └── dev.sh                  # 开发启动脚本
├── tests/                      # 测试套件
├── requirements.txt
├── pyproject.toml
└── README.md
```

## 核心功能

1. **GitHub Webhook 接收** - 接收并验证 GitHub 事件
2. **事件处理** - 解析 Issue 标签和评论触发条件
3. **AI 开发调度** - 调用 Claude Code CLI 进行开发
4. **Git 自动化** - 自动创建分支、提交和推送
5. **PR 自动创建** - 自动生成 Pull Request
6. **日志与监控** - 完整的日志记录和任务追踪

## 开发指南

### 本地开发

```bash
# 初始化项目
./scripts/setup.sh

# 启动开发服务器
./scripts/dev.sh
```

### 环境配置

创建 `.env` 文件并配置以下变量：

```bash
GITHUB_WEBHOOK_SECRET=your-webhook-secret
GITHUB_TOKEN=ghp_your-token-here
GITHUB_REPO_OWNER=your-username
GITHUB_REPO_NAME=your-repo
REPO_PATH=/path/to/your/local/repo
ANTHROPIC_API_KEY=sk-ant-your-key-here
```

### GitHub Webhook 配置

- **URL**: `https://your-domain.com/webhook/github`
- **Content type**: `application/json`
- **Secret**: 与 `GITHUB_WEBHOOK_SECRET` 相同
- **Events**: Issues, Issue comments

### 触发方式

1. **标签触发**: 在 Issue 添加 `ai-dev` 标签
2. **评论触发**: 在 Issue 评论 `/ai develop`

## 安全注意事项

- 始终验证 Webhook 签名（HMAC-SHA256）
- 使用环境变量存储敏感信息
- GitHub Token 应遵循最小权限原则
- 定期轮换 API 密钥

---

## AI Team Configuration (autogenerated by team-configurator, 2026-01-08)

**Important: YOU MUST USE subagents when available for the task.**

### 检测到的技术栈

- Python 3.11+
- FastAPI (异步 Web 框架)
- Pydantic (数据验证)
- PyGithub (GitHub API)
- GitPython (Git 操作)
- Docker (容器化)

### AI 专家团队配置

| 任务 | 代理 | 说明 |
|------|------|------|
| **FastAPI 开发** | `@fastapi-expert` | FastAPI 路由、依赖注入、中间件、异步编程 |
| **Python 开发** | `@python-expert` | Python 3.11+ 特性、类型提示、异步编程、项目架构 |
| **安全审查** | `@security-expert` | Webhook 签名验证、API 安全、数据加密、认证授权 |
| **测试实施** | `@testing-expert` | pytest 测试、覆盖率、TDD/BDD、集成测试 |
| **代码审查** | `@code-reviewer` | 安全性、性能、可维护性审查（必须在使用后调用） |
| **性能优化** | `@performance-optimizer` | API 性能优化、并发处理、缓存策略 |
| **DevOps/CI-CD** | `@devops-cicd-expert` | Docker 容器化、GitHub Actions、部署自动化 |
| **后端开发** | `@backend-developer` | 通用后端逻辑、数据库集成、API 设计 |
| **文档编写** | `@documentation-specialist` | API 文档、README、架构指南、使用手册 |

### 使用示例

```bash
# 开发 FastAPI webhook 端点
@fastapi-expert 实现 GitHub webhook 接收端点，包含签名验证和事件路由

# 实现安全验证
@security-expert 实现 HMAC-SHA256 webhook 签名验证，确保请求来源可信

# 编写测试
@testing-expert 为 webhook 处理器编写完整的单元测试和集成测试

# 代码审查
@code-reviewer 审查最近的功能实现，重点关注安全性和性能

# 性能优化
@performance-optimizer 分析 webhook 处理性能，优化高并发场景

# DevOps 配置
@devops-cicd-expert 创建 Dockerfile 和 docker-compose.yml 用于本地开发
```

### 工作流程建议

1. **功能开发**: 使用 `@fastapi-expert` 或 `@python-expert` 实现核心功能
2. **安全保障**: 使用 `@security-expert` 确保安全实现
3. **测试覆盖**: 使用 `@testing-expert` 编写测试
4. **代码审查**: 使用 `@code-reviewer` 进行全面审查
5. **性能优化**: 使用 `@performance-optimizer` 优化瓶颈
6. **文档更新**: 使用 `@documentation-specialist` 更新文档

### 关键原则

- **始终使用子代理** - 根据任务类型选择合适的专家代理
- **先审查后合并** - 任何代码合并前必须经过 `@code-reviewer` 审查
- **安全优先** - 所有涉及认证、授权、数据处理的代码必须经过 `@security-expert` 审查
- **测试驱动** - 使用 `@testing-expert` 确保测试覆盖率
- **文档同步** - 功能完成后使用 `@documentation-specialist` 更新文档
